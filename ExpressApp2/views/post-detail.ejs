<!DOCTYPE html>
<html lang="en">
    <head>
            POST SOMETHING
    </head>
    <body>

        <h2><%= postDetail.title %></h2>
        <p><%= postDetail.description %></p>
        <span><%= postDetail.by %></span><br>
        <span><%= postDetail.url %></span><br>
        <table border="1">
            <%
            if (typeof posts != 'undefined' && posts.length > 0) {
            var srNo = 0;
            posts.forEach( function ( post ){
            srNo = srNo + 1;
            %>
            <tr>
                <td><%= srNo %></td>
                <td><%= post.title %></td>
                <td><a href="/posts/detail/<%= post._id %>" title="Post Detail">Detail</a></td>

            </tr>
            <% });
            }
            else {  %>
            <tr><td colspan="3"> No Data </td></tr>
            <% } %>

        </table>

        <div class="comments">
            <%
            if (typeof comments != 'undefined' && comments != null) {
            comments.forEach( function ( commentData ){
            %>
            <p> <%= commentData.comment %> </p>
            <% });
            } %>

        </div>

<textarea id="comment" rows="3" cols="50"></textarea><br>
        <input type="hidden" id="postId" value="<%= postId %>">
        <input type="submit" value="Send" id="send">

        <script type="text/javascript">
            var socket = io();
            $('#send').click(function () {
                var comment = $('#comment').val();
                var postId = $('#postId').val();
                if (comment != '') {
                    var data = { 'comment': comment, 'postId': postId };
                    $('.comments').append("<p>" + comment + "</p>");
                    $('#comment').val('');
                }

                socket.emit('comment', data);


            });

            socket.on('comment', function (data) {
                var postId = "<%= postId %>";
                if (postId == data.postId) {
                    $('.comments').append("<p>" + data.comment + "</p>");
                }
            });


        </script>
    </body>
</html>